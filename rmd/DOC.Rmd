---
title: "DOC_NAAMES_Remin_Bioassays"
author: "Nicholas Baetge"
date: "5/19/2020"
output: github_document
---

# Intro

This document shows how **individual bottle** DOC data from NAAMES remineralization bioassays were processed, QC'd, and analyzed. 

```{r message = F, warning = F}
library(tidyverse) 
library(rmarkdown)
library(knitr)
library(readxl)
library(data.table) 
library(scales)
library(zoo)
library(oce)
library(patchwork)
#rmarkdown tables
library(stargazer)
library(pander)
library(growthcurver)
#stat tests
library(lmtest)
library(lmodel2)
library(rstatix)
library(ggpubr)
```


```{r include = FALSE}
custom_theme <- function() {
  theme_test(base_size = 16) %+replace%
    theme(legend.position = "top",
          legend.title = element_blank(),
          legend.spacing.x = unit(0.5,"cm"),
          legend.background = element_rect(fill = "transparent",colour = NA),
          legend.key = element_rect(fill = "transparent",colour = NA),
          panel.background = element_rect(fill = "transparent",colour = NA),
          plot.background = element_rect(fill = "transparent",colour = NA),
          strip.text.x = element_text(size = 14, color = "white", face = "bold.italic"),
          strip.text.y = element_text(size = 14, color = "white", face = "bold.italic", angle = 270),
          strip.background = element_rect(color = "black", fill = "#005a9c", size = 0.5, linetype = "solid")) 
}

custom_theme_linedraw <- function() {
  theme_linedraw(base_size = 16) %+replace%
    theme(legend.position = "top",
          legend.title = element_blank(),
          legend.spacing.x = unit(0.5,"cm"),
          legend.background = element_rect(fill = "transparent",colour = NA),
          legend.key = element_rect(fill = "transparent",colour = NA),
          panel.background = element_rect(fill = "transparent",colour = NA),
          plot.background = element_rect(fill = "transparent",colour = NA),
          strip.text.x = element_text(size = 14, color = "white", face = "bold.italic"),
          strip.text.y = element_text(size = 14, color = "white", face = "bold.italic", angle = 270),
          strip.background = element_rect(color = "black", fill = "#005a9c", size = 0.5, linetype = "solid")) 
}

custom.colors <- c("AT39" = "#377EB8", "AT34" = "#4DAF4A", "AT38" = "#E41A1C", "AT32" = "#FF7F00", "Temperate" = "#A6CEE3", "Subpolar" = "#377EB8", "Subtropical" = "#FB9A99", "GS/Sargasso" = "#E41A1C", "Early Spring" = "#377EB8", "Late Spring" = "#4DAF4A","Early Autumn" = "#E41A1C", "Summer" = "#E41A1C", "Late Autumn" = "#FF7F00", "A" = "#E41A1C", "B" = "#377EB8", "C" = "#4DAF4A", "D" = "#FF7F00", "E" = "#FDB927", "F" = "#552583", "G" = "#FDB927", "H" = "#552583",   "Control" = "#E41A1C", "TW12" = "#377EB8", "T. Weissflogii 12C Exudate" = "#377EB8", "TW13" = "#4DAF4A", "T. Weissflogii 13C Exudate" = "#4DAF4A", "MixDS" = "#377EB8", "Deep Comm., Surface DOM" = "#377EB8","MixSD" = "#4DAF4A", "Surface Comm., Deep DOM" = "#4DAF4A", "SynLys" = "#377EB8", "Synechococcus Lysate" = "#377EB8", "SynExd" = "#4DAF4A", "Synechococcus Exudate" = "#4DAF4A", "TWExd" = "#FF7F00", "T. Weissflogii Exudate" = "#FF7F00", "TW5" = "#377EB8", "TW10" = "#4DAF4A", "TW20" = "#FF7F00", "Parallel" = "#377EB8", "W" = "#552583", "Whole Seawater" = "#552583", "1.2" = "#4DAF4A", "1.2 µm Filtrate" = "#4DAF4A", "NV" = "#FF7F00", "1.2 µm Filtrate: TFF Filtrate (3:7)" = "#FF7F00", "Carbon" = "#E41A1C", "Nitrogen" = "#377EB8", "+5 µmol C/L Exudate" = "#FF7F00", "+10 µmol C/L Exudate" = "#FF7F00", "+20 µmol C/L Exudate" = "#FF7F00", "Filter 1" = "#E41A1C", "Filter 2" = "#377EB8", "10 m" = "#E41A1C", "200 m" = "#377EB8", "BCD" = "#377EB8" , "NPP" = "#4DAF4A" , "Cruise Specific BGE" = "#377EB8", "Global BGE" = "#4DAF4A") 

custom.shapes <- c("Early Spring" = 21, "Late Spring" = 22,"Early Autumn" = 23)

custom.lines <- c("GS/Sargasso" = "blank", "Subtropical" = "solid", "Temperate" = "longdash", "Subpolar" = "dotted" )


levels = c("GS/Sargasso", "Subtropical", "Temperate", "Subpolar",  "AT39-6", "AT34", "AT38", "AT32","South", "North", "Early Spring", "Late Spring","Early Autumn",  "Summer", "Late Autumn", "Control", "Parallel", "SynLys", "SynExd", "TWExd", "MixSD", "MixDS", "TW12", "TW13", "TW5", "TW10", "TW20",  "Surface Comm., Deep DOM", "Deep Comm., Surface DOM", "Synechococcus Exudate", "Synechococcus Lysate", "T. Weissflogii Exudate", "T. Weissflogii 12C Exudate", "T. Weissflogii 13C Exudate", "+5 µmol C/L Exudate", "+10 µmol C/L Exudate","+20 µmol C/L Exudate", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "W", "Whole Seawater","1.2", "1.2 µm Filtrate","NV", "1.2 µm Filtrate: TFF Filtrate (3:7)")
```

# Import and Tidy Data

We will need to tidy the data in the same way the bacterial abundance dataframe was tidied before merging the datasets. We'll then omit data low quality data i.e. poor replication or possible contamination. We observed contamination in many of the NAAMES 2 experiments after incubations were transferred to WHOI.

```{r message = F}
oc.df <- read_csv("~/naames_bioav_ms/Input/N2-4_DOC_Remin_Master.csv") %>%
  mutate(Season = Cruise,
         Season = gsub("AT34", "Late Spring", Season),
         Season = gsub("AT38", "Early Autumn", Season),
         Season = gsub("AT39", "Early Spring", Season),
         Treatment = ifelse(Bottle == "Niskin", "Niskin", Treatment),
         Treatment = ifelse(Bottle == "GF75", "GF75", Treatment),
         Treatment = gsub("TW15", "TW20", Treatment),
         Treatment = ifelse(is.na(Treatment), Bottle, Treatment),
         Treatment = ifelse(Treatment %in% c("Surface", "Deep"), "Parallel", Treatment),
         Treatment = ifelse(Treatment %in% c("100mls", "250mls", "500mls", "1L"), "Volume", Treatment),
         Treatment_Btl = ifelse(Bottle == "Niskin", "Niskin", Treatment_Btl),
         Treatment_Btl = ifelse(Bottle == "GF75" & is.na(Treatment_Btl), "GF75", Treatment_Btl),
         Treatment_Btl = gsub("TW15", "TW20", Treatment_Btl),
         Treatment_Btl = gsub("TW12-A", "TW12-C", Treatment_Btl),
         Treatment_Btl = gsub("TW12-B", "TW12-D", Treatment_Btl),
         Treatment_Btl = gsub("TW13-A", "TW12-E", Treatment_Btl),
         Treatment_Btl = gsub("TW13-B", "TW12-F", Treatment_Btl),
         Treatment_Btl = ifelse(is.na(Treatment_Btl), Bottle, Treatment_Btl),
         Bottle = gsub("SA", "A", Bottle),
         Bottle = gsub("SB", "B", Bottle),
         Bottle = gsub("DA", "C", Bottle),
         Bottle = gsub("DB", "D", Bottle),
         Bottle = ifelse(Bottle == "GF75", Treatment_Btl, Bottle),
         Bottle = gsub("Control-", "", Bottle),
         Bottle = gsub("TW12-", "", Bottle),
         Bottle = gsub("TW13-", "", Bottle),
         Bottle = gsub("MixDS-", "", Bottle),
         Bottle = gsub("MixSD-", "", Bottle),
         Bottle = gsub("SynExd-", "", Bottle),
         Bottle = gsub("TWExd-", "", Bottle),
         Bottle = gsub("SynLys-", "", Bottle),
         Bottle = gsub("TW5-", "", Bottle),
         Bottle = gsub("TW10-", "", Bottle),
         Bottle = gsub("TW20-", "", Bottle),
         Bottle = gsub("12", "", Bottle),
         Bottle = gsub("13", "", Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 10 & Treatment == "TW12" & Bottle == "A", gsub("A", "C", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 10 & Treatment == "TW12" & Bottle == "B", gsub("B", "D", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 10 & Treatment == "TW13" & Bottle == "A", gsub("A", "E", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 10 & Treatment == "TW13" & Bottle == "B", gsub("B", "F", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 200 & Treatment == "Control" & Bottle == "C", gsub("C", "G", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 200 & Treatment == "Control" & Bottle == "D", gsub("D", "H", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 200 & Treatment == "TW12" & Bottle == "C", gsub("C", "I", Bottle),Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 200 & Treatment == "TW12" & Bottle == "D", gsub("D", "J", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 200 & Treatment == "TW13" & Bottle == "C", gsub("C", "K", Bottle), Bottle),
         Bottle = ifelse(Cruise == "AT34" & Station == 2 & Depth == 200 & Treatment == "TW13" & Bottle == "D", gsub("D", "L", Bottle), Bottle),
         Depth = gsub(5, 10, Depth),
         Depth = as.numeric(Depth),
         key = paste(Cruise, Station, Depth, Treatment, Bottle, Timepoint, sep = "."),
         PTOC_ave = ifelse(Treatment == "Parallel", TOC_ave, PTOC_ave),
         PTOC_sd = ifelse(Treatment == "Parallel", TOC_sd, PTOC_sd)) %>% 
  rename(doc = DOC_ave,
         sd_doc = DOC_sd,
         toc = TOC_ave, 
         sd_toc = TOC_sd, 
         ptoc = PTOC_ave, 
         sd_ptoc = PTOC_sd, 
         pdoc = PDOC_ave, 
         sd_pdoc = PDOC_sd) %>%
  filter(!Treatment %in% c("Niskin", "GF75", "TFF-Ret", "Volume")) %>% 
  select(-Treatment_Btl) %>% 
  select(Season, everything()) %>% 
  arrange(Cruise, Station, Depth, Treatment, Bottle, Hours)  %>% 
  filter(!is.na(Hours))

```

Because a different suite of organic carbon samples were taken on each cruise, we'll separate the cruise datasets, drop NA values, quality filter them, and then recombine the datasets. To quality filter, we'll calculate rolling ∆DOC values i.e. the diffence between the one observation and the one before it. We'll omit the data where ∆DOC indicates contamination due to transport etc. after the 21 d shipboard occupation (increase greater than our detection limit, 1.5 µmol C L^-1^).

```{r}
n2_oc <- oc.df %>% 
  filter(Cruise == "AT34") %>% 
  drop_na(doc) %>%
  group_by(Station, Depth, Treatment, Bottle) %>%
  mutate(doc_from_last = lag(doc) - doc) %>% 
  filter(!doc_from_last <= -1.5 | is.na(doc_from_last) | !Hours > 504)  %>% 
  mutate(doc_from_last = lag(doc) - doc) %>% 
  filter(!doc_from_last <= -1.5 | is.na(doc_from_last) | !Hours > 504) %>% 
  mutate(doc_from_last = lag(doc) - doc) %>% 
  filter(!doc_from_last <= -1.5 | is.na(doc_from_last) | !Hours > 504) %>% 
  mutate(doc_from_last = lag(doc) - doc,
         doc_from_t0 = first(doc) - doc) %>% 
  filter(!Station == 4 | !Hours == 192) %>% 
  ungroup()

n3_4_oc <- oc.df %>% 
  filter(!Cruise == "AT34") %>% 
  drop_na(ptoc) %>% 
  group_by(Cruise, Station, Depth, Treatment, Bottle) %>% 
  mutate(ptoc_from_last = lag(ptoc) - ptoc) %>% 
  filter(!ptoc_from_last <= -1.5 | is.na(ptoc_from_last) | !Hours > 504) %>% 
  mutate(ptoc_from_last = lag(ptoc) - ptoc,
         ptoc_from_t0 = first(ptoc) - ptoc,
         doc_from_t0 = first(doc) - doc,
         toc_from_t0 = first(toc) - toc, 
         pdoc_from_t0 = first(pdoc) - pdoc) %>%
  ungroup()

oc_p <- bind_rows(n2_oc, n3_4_oc) %>% 
  mutate(Days = round(Hours/24, 2),
         facet_depth = paste(Depth, "m"), 
         facet_treatment = Treatment, 
         facet_treatment = gsub("MixSD", "Surface Comm., Deep DOM", facet_treatment),
         facet_treatment = gsub("MixDS", "Deep Comm., Surface DOM", facet_treatment),
          facet_treatment = gsub("SynExd", "Synechococcus Exudate", facet_treatment),
         facet_treatment = gsub("SynLys", "Synechococcus Lysate", facet_treatment),
          facet_treatment = gsub("TWExd", "T. Weissflogii Exudate", facet_treatment),
         facet_treatment = gsub("TW5", "+5 µmol C/L Exudate", facet_treatment),
          facet_treatment = gsub("TW10", "+10 µmol C/L Exudate", facet_treatment),
          facet_treatment = gsub("TW20", "+20 µmol C/L Exudate", facet_treatment),
           facet_treatment = gsub("TW12", "T. Weissflogii 12C Exudate", facet_treatment),
          facet_treatment = gsub("TW13", "T. Weissflogii 13C Exudate", facet_treatment),
         facet_bottle = Bottle,
         facet_bottle = gsub("W", "Whole Seawater", facet_bottle),
          facet_bottle = gsub("1.2", "1.2 µm Filtrate", facet_bottle), 
          facet_bottle = gsub("NV", "1.2 µm Filtrate: TFF Filtrate (3:7)", facet_bottle)) 

oc_p$Treatment <- factor(oc_p$Treatment, levels = levels)
oc_p$facet_treatment <- factor(oc_p$facet_treatment, levels = levels)
oc_p$facet_bottle <- factor(oc_p$facet_bottle, levels = levels)
```

# Save Data

```{r}
#saveRDS(oc_p, "~/naames_bioav_ms/Output/processed_doc.rds")
```



# Plot Curves

## NAAMES 2

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT34", Treatment == "Control") %>% 
  mutate(facet_depth = paste(Depth, "m")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = doc, group = Bottle)) + 
  geom_errorbar(aes(ymin = doc - sd_doc, ymax = doc + sd_doc), width = 0.5) +
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(facet_depth ~ Station, scales = "free") +
  labs(y = expression(paste("DOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT34", Treatment == "Control") %>% 
  mutate(facet_depth = paste(Depth, "m")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -doc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = 2) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(facet_depth ~ Station, scales = "free") +
  labs(y = expression(paste("Delta DOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F) +
  
  plot_annotation( title = "NAAMES 2 DOC: Control Experiments, > 30 d" ) 

```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT34", Treatment == "Control", Days <= 7) %>% 
  mutate(facet_depth = paste(Depth, "m")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = doc, group = Bottle)) + 
  geom_errorbar(aes(ymin = doc - sd_doc, ymax = doc + sd_doc), width = 0.5) +
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(facet_depth ~ Station, scales = "free") +
  labs(y = expression(paste("DOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT34", Treatment == "Control", Days <= 7) %>% 
  mutate(facet_depth = paste(Depth, "m")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -doc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = 2) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(facet_depth ~ Station, scales = "free") +
  labs(y = expression(paste("Delta DOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F) +
  
  plot_annotation( title = "NAAMES 2 DOC: Control Experiments, < 7 d") 

```

There looks to be some poor replication between the experiments conducted at station 4 and U:

- S4 bottle A measurements look suspect. additionally, the increase between day 6 and 7 for both bottles are suspect
- SU bottle B measurements at 24 h is suspect relative to the downward trend in both bottles

These points will affect BGE calculations and my need to be omitted. The BGE from S4 Bottle A may be unreliable. 

BGEs cannot be calculated for the 200 m control experiments given that not DOC drawdown was observed.

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 10, fig.width = 10, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT34", Station == 2) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = doc, group = Bottle)) + 
  geom_errorbar(aes(ymin = doc - sd_doc, ymax = doc + sd_doc), width = 0.5) +
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_depth, scales = "free_y") +
  labs(x = "", y = expression(paste("DOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT34", Station == 2) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -doc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_depth, scales = "free") +
  labs(y = expression(paste("Delta DOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F) +
  theme(strip.background = element_blank(), strip.text = element_blank()) +

  plot_annotation( title = "NAAMES 2 Station 2 Addition Experiment" ) +
  plot_layout(nrow = 2, ncol = 1)



```


## NAAMES 3


```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 6, fig.width = 20, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT38", Treatment == "Control") %>%  
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = ptoc, group = Bottle)) + 
  geom_errorbar(aes(ymin = ptoc - sd_ptoc, ymax = ptoc + sd_ptoc), width = 0.5) +
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(facet_depth ~ Station, scales = "free") +
  labs(y = expression(paste("TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT38", Treatment == "Control") %>%  
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -ptoc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(facet_depth ~ Station, scales = "free") +
  labs(y = expression(paste("Delta TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F) +
  
  plot_annotation( title = "NAAMES 3 TOC: Control Experiments" ) 

```


```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 10, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT38", Station == 1, !Treatment %in% c("SynExd", "SynLys", "TWExd")) %>%
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = ptoc, group = Bottle)) + 
  geom_errorbar(aes(ymin = ptoc - sd_ptoc, ymax = ptoc + sd_ptoc), width = 0.5) +
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_depth, scales = "free") +
  labs(x = "", y = expression(paste("TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT38", Station == 1, !Treatment %in% c("SynExd", "SynLys", "TWExd")) %>%
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -ptoc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_depth, scales = "free") +
  labs(y = expression(paste("Delta TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F) +
  theme(strip.background = element_blank(), strip.text = element_blank()) +
  
  plot_annotation( title = "NAAMES 3 Station 1 Mixing Experiment" ) +
  plot_layout(nrow = 2, ncol = 1)
  

```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 10, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT38", Station == 1, Treatment %in% c("Control", "SynExd", "SynLys", "TWExd")) %>%
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = ptoc, group = Bottle)) + 
  geom_errorbar(aes(ymin = ptoc - sd_ptoc, ymax = ptoc + sd_ptoc), width = 0.5) +
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_depth, scales = "free") +
  labs(x = "", y = expression(paste("TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT38", Station == 1, Treatment %in% c("Control", "SynExd", "SynLys", "TWExd")) %>%
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -ptoc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_depth, scales = "free") +
  labs(y = expression(paste("Delta TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F) +
  theme(strip.background = element_blank(), strip.text = element_blank()) +
  
  plot_annotation( title = "NAAMES 3 Station 1 Addition Experiment" ) +
  plot_layout(nrow = 2, ncol = 1)

```


```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 10, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT38", Depth == 10, Station %in% c(1, 3, 6), Treatment %in% c("Control", "SynLys")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = ptoc, group = Bottle)) + 
  geom_errorbar(aes(ymin = ptoc - sd_ptoc, ymax = ptoc + sd_ptoc), width = 0.5) +
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~Station, scales = "free_y") +
  labs(x = "",  y = expression(paste("TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT38", Depth == 10, Station %in% c(1, 3, 6), Treatment %in% c("Control", "SynLys")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -ptoc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = facet_treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~Station, scales = "free_y") +
  labs(y = expression(paste("Delta TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F) +
  theme(strip.background = element_blank(), strip.text = element_blank()) +
  
  plot_annotation( title = "NAAMES 3 Addition Experiments" ) +
  plot_layout(nrow = 2, ncol = 1)

```


## NAAMES 4

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 14, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT39", Treatment == "Control") %>% 
  mutate(facet_depth = paste(Depth, "m")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = ptoc, group = Bottle)) + 
  geom_errorbar(aes(ymin = ptoc - sd_ptoc, ymax = ptoc + sd_ptoc), width = 0.5) +
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~Station, scales = "free") +
  labs(x = "",y = expression(paste("TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT39", Treatment == "Control") %>% 
  mutate(facet_depth = paste(Depth, "m")) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -ptoc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = Bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Bottle), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~Station, scales = "free") +
  labs(y = expression(paste("Delta TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(fill = F, color = F) +
  theme(strip.background = element_blank(), strip.text = element_blank()) +
  
  plot_annotation( title = "NAAMES 4 PTOC: Control Experiments" ) +
  plot_layout(nrow = 2, ncol = 1)

```

The replication between experiments at Station 4 is poor. 

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 6, fig.width = 10, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT39", Station == 2, !Treatment == "Parallel") %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = ptoc, group = Bottle)) + 
  geom_errorbar(aes(ymin = ptoc - sd_ptoc, ymax = ptoc + sd_ptoc), width = 0.5) +
  geom_point(aes(fill = Treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_treatment, scales = "free_y") +
  labs(x = "", y = expression(paste("TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(fill = F, color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT39", Station == 2, !Treatment == "Parallel") %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -ptoc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = Treatment), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = Treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~facet_treatment, scales = "free_y") +
  labs(y = expression(paste("Delta TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(fill = F, color = F) +
  theme(strip.background = element_blank(), strip.text = element_blank()) +
  
  plot_annotation( title = "NAAMES 4 Addition Experiments" ) +
  plot_layout(nrow = 2, ncol = 1)

```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 14, fig.align = "center", warning = FALSE}
oc_p %>% 
  filter(Cruise == "AT39", Treatment %in% c("Control", "Parallel"), Depth == 10) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = ptoc, group = Bottle)) + 
  geom_errorbar(aes(ymin = ptoc - sd_ptoc, ymax = ptoc + sd_ptoc), width = 0.5) +
  geom_point(aes(fill = facet_bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_bottle, linetype = Treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~Station, scales = "free") +
  labs(x = "", y = expression(paste("TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F) +
  
  oc_p %>% 
  filter(Cruise == "AT39", Treatment %in% c("Control", "Parallel"), Depth == 10) %>% 
  group_by(Station, Depth, Treatment, Bottle) %>%
  ggplot(aes(x = Days, y = -ptoc_from_t0, group = Bottle)) + 
  geom_point(aes(fill = facet_bottle), size = 4, shape = 21, alpha = 0.7 ) +
  geom_line(aes(color = facet_bottle, linetype = Treatment), alpha = 0.7) +
  scale_color_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  facet_grid(~Station, scales = "free_y") +
  labs(y = expression(paste("Delta TOC, µmol C L"^-1))) +
  custom_theme() +
  guides(color = F, fill = F, linetype = F) +
  theme(strip.background = element_blank(), strip.text = element_blank()) +
  
  plot_annotation( title = "NAAMES 4 Parallel Experiments" ) +
  plot_layout(nrow = 2, ncol = 1)
 
```

---
title: "Miscellaneous"
author: "Nicholas Baetge"
date: "2/29/2020"
output: github_document
---

# Profiles


```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
bcd %>% 
  drop_na(bp.cr.sr) %>% 
  filter(Depth %in% c(0, 5, 10, 25, 75, 100, 150, 200, 300)) %>% 
  select(Season, Cruise, Subregion, Depth, ave_Ez, bp.cr.sr, sd_bp.cr.sr) %>% 
  distinct() %>% 
  ggplot(aes(x = Depth, y = bp.cr.sr, group = interaction(Cruise, Subregion))) +
  geom_errorbar(aes(x = Depth, ymin = bp.cr.sr - sd_bp.cr.sr, ymax = bp.cr.sr + sd_bp.cr.sr, color = Season), width = 2, size = 0.5) +
  geom_line(aes(colour = factor(Season, levels = levels)), size = 0.7) +
  geom_point(aes(fill = factor(Season, levels = levels)), size = 4, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("Bacterial Production, µmol C m"^3, "d"^-1))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  #scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  #guides(fill = F) +
  custom_theme() +
  facet_grid(~factor(Subregion, levels = levels), scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"))
```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 8, fig.width = 20, fig.align = "center", warning = FALSE}
bcd %>% 
  drop_na(ba.cr.sr) %>% 
  filter(Depth %in% c(0, 5, 10, 25, 75, 100, 150, 200, 300)) %>% 
  select(Season, Cruise, Subregion, Depth, ba.cr.sr, sd_ba.cr.sr) %>% 
  distinct() %>% 
  ggplot(aes(x = Depth, y = ba.cr.sr, group = interaction(Cruise, Subregion))) +
  geom_errorbar(aes(x = Depth, ymin = ba.cr.sr - sd_ba.cr.sr, ymax = ba.cr.sr + sd_ba.cr.sr, color = Season), width = 2, size = 0.5) +
  geom_line(aes(colour = factor(Season, levels = levels)), size = 0.7) +
  geom_point(aes(fill = factor(Season, levels = levels)), size = 4, shape = 21, color = "black", stroke = 1, alpha = 0.7) + 
  labs(x = expression(italic(paste("Depth, m"))), y = expression(italic(paste("Bacterial Abundance, Cells m"^3))), colour = "") +
  scale_x_reverse(breaks = pretty_breaks(), expand = c(0,0)) +
  coord_flip() +
  #scale_y_continuous(expand = c(0,0)) +
  scale_colour_manual(values = custom.colors) +
  scale_fill_manual(values = custom.colors) +
  guides(colour = F) +
  #guides(fill = F) +
  custom_theme() +
  facet_grid(~factor(Subregion, levels = levels), scales = "free") +
  theme(panel.spacing.x = unit(1, "cm"))
```


# ∆DOC

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 3.5, fig.width = 14, fig.align = "center", warning = FALSE}

export %>% 
  select(Season:Station, degree_bin, Subregion,  int_delta_DOC_100) %>% 
  drop_na(int_delta_DOC_100) %>% 
  distinct() %>% 
  mutate_at(vars(contains("NPP")), funs(round(./10^3,2))) %>% 
  mutate_at(vars(degree_bin), as.character) %>% 
  ##PLOT
  ggplot(aes(x = degree_bin, y =  int_delta_DOC_100, group = interaction(Season, Station, degree_bin)))  + 
  geom_bar(fill = "#999999", position = position_dodge(), stat = "identity", color = "black",  alpha = 1) +
  labs(x = expression(italic("Latitude, ˚N")), y = expression(italic(paste("∆DOC, mol C m"^-2))), colour = expression(italic(""))) +
  scale_y_continuous(breaks = pretty_breaks()) +
  #scale_fill_manual(values = custom.colors) +
  custom_theme() +
  facet_grid(~factor(Season, levels = levels), scales = "free") 
  #theme(strip.background = element_blank(), strip.text = element_blank()) 
```


```{r}
aov.delta_doc <- export_bioav %>%
  select(Season, int_delta_DOC_100) %>% 
  distinct() %>% 
  drop_na(int_delta_DOC_100) 

```

## Welch's one-Way ANOVA test 

Alternative to standard one-way ANOVA in the situation where the homogeneity of variance assumption iss violated

```{r}
ddoc_anova <- welch_anova_test(int_delta_DOC_100 ~ Season, data = aov.delta_doc) 
ddoc_anova 
```


## Post-hoc analysis

Games-Howell test used to compare all possible combinations of group differences when the assumption of homogeneity of variances is violated

```{r}
ddoc_gh <- games_howell_test(int_delta_DOC_100 ~ Season, data = aov.delta_doc)
ddoc_gh
```


```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 5, fig.width = 6, fig.align = "center", warning = FALSE}
library(ggpubr)

export %>%
  select(Season, int_delta_DOC_100) %>% 
  distinct() %>% 
  drop_na(int_delta_DOC_100) %>% 
  ggplot(aes(x = factor(Season, levels = levels), y = int_delta_DOC_100)) +
  geom_boxplot(width = 0.3, outlier.fill = "white", outlier.color = "white") +
  geom_jitter(fill = "white", width = 0.1, shape = 21, size = 3, alpha = 0.7) + 
  labs(x = "", y = expression(italic("Seasonally Accumulated DOC, mol C m"^-2)), colour = expression(italic(""))) + 
  scale_fill_brewer(palette = "Set1") +
  custom_theme() +
  annotate( geom = "text", label = expression(paste("Welch's one-Way ANOVA, ", italic("p "), "<< 0.01")), x = "Early Spring", y = 2.1, size = 4, hjust = 0)  +
  stat_pvalue_manual(
    ddoc_gh, label = "p.adj.signif", 
    y.position = c(1.5, 1.4, 1.3, 1.8, 0.45, 1.7)
    )
  
  
```


# DOC:DON

```{r}
aov.cn <- export %>%
  select(Season, doc_don_100) %>% 
  distinct() %>% 
  drop_na(doc_don_100) %>% 
  filter(!doc_don_100 > 90) 

```
## Welch's one-Way ANOVA test 

Alternative to standard one-way ANOVA in the situation where the homogeneity of variance assumption iss violated

```{r}

cn_anova <- welch_anova_test(doc_don_100 ~ Season, data = aov.cn) 
cn_anova 
```


## Post-hoc analysis

Games-Howell test used to compare all possible combinations of group differences when the assumption of homogeneity of variances is violated

```{r}
cn_gh <- games_howell_test(doc_don_100 ~ Season, data = aov.cn)
cn_gh
```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height = 5, fig.width = 6, fig.align = "center", warning = FALSE}
export %>%
  select(Season, doc_don_100) %>% 
  distinct() %>% 
  drop_na(doc_don_100) %>% 
  ggplot(aes(x = factor(Season, levels = levels), y = doc_don_100)) +
  geom_boxplot(width = 0.3, outlier.color = "white", outlier.fill = "white") +
  geom_jitter(fill = "white", width = 0.1, shape = 21, size = 3, alpha = 0.7) + 
  labs(x = "", y = expression(italic("Seasonally Accumulated DOC:DON")), colour = expression(italic(""))) + 
  scale_fill_brewer(palette = "Set1") +
  custom_theme() +
  annotate( geom = "text", label = expression(paste("Welch's one-Way ANOVA, ", italic("p "), "= 0.15")), x = "Early Spring", y = 95, size = 4, hjust = 0) 
  
  
```

```{r}
export %>%
  select(Season, int_delta_DOC_100, doc_don_100) %>% 
  rename(accm_doc = int_delta_DOC_100) %>% 
  group_by(Season) %>% 
  summarise(ave_accm_doc = round(mean(accm_doc, na.rm = T), 2),
            sd_accm_doc = round(sd(accm_doc, na.rm = T), 2),
            med_accm_doc = round(median(accm_doc, na.rm = T), 2),
            min_accm_doc = round(min(accm_doc, na.rm = T), 2),
            max_accm_doc = round(max(accm_doc, na.rm = T), 2),
            
            ave_doc_don = round(mean(doc_don_100, na.rm = T)),
            sd_doc_don = round(sd(doc_don_100, na.rm = T)),
            med_doc_don = round(median(doc_don_100, na.rm = T)),
            min_doc_don = round(min(doc_don_100, na.rm = T)),
            max_doc_don = round(max(doc_don_100, na.rm = T))
            ) %>% 
   arrange(factor(Season, levels = levels))
  
```

```{r}
export %>%
  select(Season, doc_don_100) %>% 
  group_by(Season) %>% 
  filter(!doc_don_100 > 90) %>% 
  summarise(ave_doc_don = round(mean(doc_don_100, na.rm = T)),
            sd_doc_don = round(sd(doc_don_100, na.rm = T)),
            med_doc_don = round(median(doc_don_100, na.rm = T)),
            min_doc_don = round(min(doc_don_100, na.rm = T)),
            max_doc_don = round(max(doc_don_100, na.rm = T))
            ) %>% 
   arrange(factor(Season, levels = levels))
  
```





